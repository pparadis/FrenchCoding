(function(){var t={}.hasOwnProperty,n=function(n,i){function u(){this.constructor=n}for(var r in i)t.call(i,r)&&(n[r]=i[r]);return u.prototype=i.prototype,n.prototype=new u,n.__super__=i.prototype,n};Dropbox.Drivers.BrowserBase=function(){function n(n){this.rememberUser=(n!=null?n.rememberUser:void 0)||!1,this.useQuery=(n!=null?n.useQuery:void 0)||!1,this.scope=(n!=null?n.scope:void 0)||"default",this.storageKey=null,this.dbTokenRe=new RegExp("(#|\\?|&)dboauth_token=([^&#]+)(&|#|$)"),this.rejectedRe=new RegExp("(#|\\?|&)not_approved=true(&|#|$)"),this.tokenRe=new RegExp("(#|\\?|&)oauth_token=([^&#]+)(&|#|$)")}return n.prototype.onAuthStateChange=function(n,t){var i=this;this.setStorageKey(n);switch(n.authState){case DropboxClient.RESET:return this.loadCredentials(function(r){return r?r.authState?(n.setCredentials(r),t()):i.rememberUser?(n.setCredentials(r),n.getUserInfo(function(r){return r?(n.reset(),i.forgetCredentials(t)):t()})):(i.forgetCredentials(),t()):t()});case DropboxClient.REQUEST:return this.storeCredentials(n.credentials(),t);case DropboxClient.DONE:return this.rememberUser?this.storeCredentials(n.credentials(),t):this.forgetCredentials(t);case DropboxClient.SIGNED_OFF:return this.forgetCredentials(t);case DropboxClient.ERROR:return this.forgetCredentials(t);default:return t(),this}},n.prototype.setStorageKey=function(n){return this.storageKey="dropbox-auth:"+this.scope+":"+n.appHash(),this},n.prototype.storeCredentials=function(n,t){return localStorage.setItem(this.storageKey,JSON.stringify(n)),t(),this},n.prototype.loadCredentials=function(n){var t;if(t=localStorage.getItem(this.storageKey),!t)return n(null),this;try{n(JSON.parse(t))}catch(i){n(null)}return this},n.prototype.forgetCredentials=function(n){return localStorage.removeItem(this.storageKey),n(),this},n.prototype.computeUrl=function(n){var i,t,u,r;return r="_dropboxjs_scope="+encodeURIComponent(this.scope)+"&dboauth_token=",t=n,t.indexOf("#")===-1?i=null:(u=t.split("#",2),t=u[0],i=u[1]),this.useQuery?(t+=t.indexOf("?")===-1?"?"+r:"&"+r,i?[t,"#"+i]:[t,""]):[t+"#?"+r,""]},n.prototype.locationToken=function(n){var t,i,r;return(t=n||Dropbox.Drivers.BrowserBase.currentLocation(),r="_dropboxjs_scope="+encodeURIComponent(this.scope)+"&",(typeof t.indexOf=="function"?t.indexOf(r):void 0)===-1)?null:this.rejectedRe.test(t)?(i=this.dbTokenRe.exec(t),i?decodeURIComponent(i[2]):null):(i=this.tokenRe.exec(t),i)?decodeURIComponent(i[2]):null},n.currentLocation=function(){return window.location.href},n}(),Dropbox.Drivers.Redirect=function(t){function i(n){var t;i.__super__.constructor.call(this,n),t=this.computeUrl(Dropbox.Drivers.BrowserBase.currentLocation()),this.receiverUrl1=t[0],this.receiverUrl2=t[1]}return n(i,t),i.prototype.onAuthStateChange=function(n,t){var r,u=this;return r=function(){return function(){return i.__super__.onAuthStateChange.call(u,n,t)}}(),this.setStorageKey(n),n.authState===DropboxClient.RESET?this.loadCredentials(function(n){return n&&n.authState?n.token===u.locationToken()&&n.authState===DropboxClient.REQUEST?(n.authState=DropboxClient.AUTHORIZED,u.storeCredentials(n,r)):u.forgetCredentials(r):r()}):r()},i.prototype.url=function(n){return this.receiverUrl1+encodeURIComponent(n)+this.receiverUrl2},i.prototype.doAuthorize=function(n){return window.location.assign(n)},i}(Dropbox.Drivers.BrowserBase),Dropbox.Drivers.Popup=function(t){function i(n){var t;i.__super__.constructor.call(this,n),t=this.computeUrl(this.baseUrl(n)),this.receiverUrl1=t[0],this.receiverUrl2=t[1]}return n(i,t),i.prototype.onAuthStateChange=function(n,t){var r,u=this;return r=function(){return function(){return i.__super__.onAuthStateChange.call(u,n,t)}}(),this.setStorageKey(n),n.authState===DropboxClient.RESET?this.loadCredentials(function(n){return n&&n.authState?u.forgetCredentials(r):r()}):r()},i.prototype.doAuthorize=function(n,t,i,r){return this.listenForMessage(t,r),this.openWindow(n)},i.prototype.url=function(n){return this.receiverUrl1+encodeURIComponent(n)+this.receiverUrl2},i.prototype.baseUrl=function(n){var t;if(n){if(n.receiverUrl)return n.receiverUrl;if(n.receiverFile)return t=Dropbox.Drivers.BrowserBase.currentLocation().split("/"),t[t.length-1]=n.receiverFile,t.join("/")}return Dropbox.Drivers.BrowserBase.currentLocation()},i.prototype.openWindow=function(n){return window.open(n,"_dropboxOauthSigninWindow",this.popupWindowSpec(980,700))},i.prototype.popupWindowSpec=function(n,t){var e,i,r,o,u,f,s,h,c,l;return u=(s=window.screenX)!=null?s:window.screenLeft,f=(h=window.screenY)!=null?h:window.screenTop,o=(c=window.outerWidth)!=null?c:document.documentElement.clientWidth,e=(l=window.outerHeight)!=null?l:document.documentElement.clientHeight,i=Math.round(u+(o-n)/2),r=Math.round(f+(e-t)/2.5),i<u&&(i=u),r<f&&(r=f),"width="+n+",height="+t+","+("left="+i+",top="+r)+"dialog=yes,dependent=yes,scrollbars=yes,location=yes"},i.prototype.listenForMessage=function(n,t){var i,r=this;return i=function(u){var f;return f=u.data?u.data:u,r.locationToken(f)===n?(n=null,window.removeEventListener("message",i),Dropbox.Drivers.Popup.onMessage.removeListener(i),t()):void 0},window.addEventListener("message",i,!1),Dropbox.Drivers.Popup.onMessage.addListener(i)},i.oauthReceiver=function(){return window.addEventListener("load",function(){var n;if(n=window.opener,window.parent!==window.top&&(n||(n=window.parent)),n){try{n.postMessage(window.location.href,"*")}catch(t){}try{n.Dropbox.Drivers.Popup.onMessage.dispatch(window.location.href)}catch(i){}}return window.close()})},i.onMessage=new Dropbox.EventSource,i}(Dropbox.Drivers.BrowserBase)}).call(this)